<!DOCTYPE html>
<html>
<body>
    <p id="deviceStatus">Not connected</p></br></br>
    <p id="activeWindow">Active window: ---</p>

    <form id="layoutForm">
        <input type="text" id="appName" placeholder="Application Name">
        <input type="text" id="button1" placeholder="Button 1">
        <input type="text" id="button2" placeholder="Button 2">
        <input type="text" id="button3" placeholder="Button 3">
        <input type="text" id="button4" placeholder="Button 4">
        <input type="text" id="button5" placeholder="Button 5">
        <input type="text" id="button6" placeholder="Button 6">
        <input type="text" id="button7" placeholder="Button 7">
        <input type="text" id="button8" placeholder="Button 8">
        <input type="text" id="button9" placeholder="Button 9">
        <input type="text" id="button10" placeholder="Button 10">
        <input type="text" id="button11" placeholder="Button 11">
        <input type="text" id="button12" placeholder="Button 12">
        <input type="text" id="button13" placeholder="Button 13">
        <input type="text" id="button14" placeholder="Button 14">
        <input type="text" id="button15" placeholder="Button 15">
        <button type="submit">Save</button>
    </form>

    <script>
        const { ipcRenderer } = require('electron')
    
        ipcRenderer.on('activeWindow', (event, windowTitle) => {
            document.getElementById('activeWindow').innerText = `Active window: ${windowTitle}`;
        });
    
        ipcRenderer.on('deviceStatus', (event, deviceStatus) => {
            document.getElementById('deviceStatus').innerText = `Device status: ${deviceStatus}`;
        });

        document.getElementById('layoutForm').addEventListener('submit', function(event) {
            event.preventDefault(); // prevent form from being submitted normally
            let layout = {
                appName: document.getElementById('appName').value,
                layout: {
                    button1: document.getElementById('button1').value,
                    button2: document.getElementById('button2').value,
                    button3: document.getElementById('button3').value,
                    button4: document.getElementById('button4').value,
                    button5: document.getElementById('button5').value,
                    button6: document.getElementById('button6').value,
                    button7: document.getElementById('button7').value,
                    button8: document.getElementById('button8').value,
                    button9: document.getElementById('button9').value,
                    button10: document.getElementById('button10').value,
                    button11: document.getElementById('button11').value,
                    button12: document.getElementById('button12').value,
                    button13: document.getElementById('button13').value,
                    button14: document.getElementById('button14').value,
                    button15: document.getElementById('button15').value,
                }
            };
            ipcRenderer.send('saveLayout', layout);
        });

        function handleKeydown(event) {
            event.preventDefault();

            let keyCombination = '';
            let key = event.code.replace('Key', '');

            if (event.ctrlKey) {
                keyCombination += 'CONTROL + ';
                key = key.replace('ControlLeft', '').replace('ControlRight', '');
            }

            if (event.shiftKey) {
                keyCombination += 'SHIFT + ';
                key = key.replace('ShiftLeft', '').replace('ShiftRight', '');
            }

            if (event.altKey) {
                keyCombination += 'ALT + ';
                key = key.replace('AltLeft', '').replace('AltRight', '');
            }

            if (event.metaKey) {
                // macOS
                if(navigator.platform.toUpperCase().indexOf('MAC')>=0) {
                    keyCombination += 'CMD + ';
                    key = key.replace('MetaLeft', '').replace('MetaRight', '');
                } else {
                    // Windows/Linux
                    keyCombination += 'WIN + ';
                    key = key.replace('MetaLeft', '').replace('MetaRight', '');
                }
            }

            keyCombination += key;

            this.value = keyCombination;
        }

        document.getElementById('button1').addEventListener('keydown', handleKeydown);
        document.getElementById('button2').addEventListener('keydown', handleKeydown);
        document.getElementById('button3').addEventListener('keydown', handleKeydown);
        document.getElementById('button4').addEventListener('keydown', handleKeydown);
        document.getElementById('button5').addEventListener('keydown', handleKeydown);
        document.getElementById('button6').addEventListener('keydown', handleKeydown);
        document.getElementById('button7').addEventListener('keydown', handleKeydown);
        document.getElementById('button8').addEventListener('keydown', handleKeydown);
        document.getElementById('button9').addEventListener('keydown', handleKeydown);
        document.getElementById('button10').addEventListener('keydown', handleKeydown);
        document.getElementById('button11').addEventListener('keydown', handleKeydown);
        document.getElementById('button12').addEventListener('keydown', handleKeydown);
        document.getElementById('button13').addEventListener('keydown', handleKeydown);
        document.getElementById('button14').addEventListener('keydown', handleKeydown);
        document.getElementById('button15').addEventListener('keydown', handleKeydown);


        function handleFocus(event) {
            this.value = '';
        }

        document.getElementById('button1').addEventListener('focus', handleFocus);
        document.getElementById('button2').addEventListener('focus', handleFocus);
        document.getElementById('button3').addEventListener('focus', handleFocus);
        document.getElementById('button4').addEventListener('focus', handleFocus);
        document.getElementById('button5').addEventListener('focus', handleFocus);
        document.getElementById('button6').addEventListener('focus', handleFocus);
        document.getElementById('button7').addEventListener('focus', handleFocus);
        document.getElementById('button8').addEventListener('focus', handleFocus);
        document.getElementById('button9').addEventListener('focus', handleFocus);
        document.getElementById('button10').addEventListener('focus', handleFocus);
        document.getElementById('button11').addEventListener('focus', handleFocus);
        document.getElementById('button12').addEventListener('focus', handleFocus);
        document.getElementById('button13').addEventListener('focus', handleFocus);
        document.getElementById('button14').addEventListener('focus', handleFocus);
        document.getElementById('button15').addEventListener('focus', handleFocus);

    </script>
</body>
</html>